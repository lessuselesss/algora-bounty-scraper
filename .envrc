#!/usr/bin/env bash

# Load the Nix development shell
use flake

# Set up XDG directories for better organization
export XDG_DATA_HOME="$PWD/.local/share"
export XDG_CONFIG_HOME="$PWD/.config"
export XDG_CACHE_HOME="$PWD/.cache"

# Deno configuration
export DENO_DIR="$XDG_CACHE_HOME/deno"
export DENO_INSTALL_ROOT="$XDG_DATA_HOME/deno/bin"

# Create necessary directories
mkdir -p "$XDG_DATA_HOME" "$XDG_CONFIG_HOME" "$XDG_CACHE_HOME"
mkdir -p "$DENO_DIR" "$DENO_INSTALL_ROOT"
mkdir -p data/archive logs secrets

# Add Deno binaries to PATH
PATH_add "$DENO_INSTALL_ROOT"

# Age key for sops (will be generated during setup)
if [ -f .age-key ]; then
  export SOPS_AGE_KEY_FILE="$PWD/.age-key"
fi

# Development settings
export RUST_LOG=debug
export LOG_LEVEL=debug

echo "üï∑Ô∏è  Development environment loaded successfully!"